<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns:stage2="http://www.bt.com/tools/designit/design2" xmlns="http://www.w3.org/2000/svg" 
	width="2000" height="2000" version="1.1" baseProfile="full"
	 onmousemove="move(evt)" onmouseup="up(evt)">
  <title>Design</title>
 <script language="JavaScript" type="text/javascript">
	  <![CDATA[
    var DRAG = 1;
    var RESIZE = 2;
    var currentBlock;
    var currentRect;
    var startX;
    var startY;
    var mode = DRAG;

    function down(evt) {
        currentBlock = evt.currentTarget;
	var matrix = currentBlock.getCTM();	
	startX = evt.clientX - matrix.e;
	startY = evt.clientY - matrix.f;
    }


    function resize(evt) {
	evt.stopPropagation();
        mode = RESIZE;
        currentBlock = evt.currentTarget.parentNode;
	var matrix = currentBlock.getCTM();	
	startX = matrix.e;
	startY = matrix.f;
    }

    function doResize(grp, width, height) {
	var rect = grp.children[0];
	var oldWidth = rect.width;
	var oldHeight = rect.height;
	rect.setAttribute('width', width);
	rect.setAttribute('height', height);	

	var triangle = grp.children[5];
	triangle.setAttribute('d', 'M ' +  width +' ' + height + ' v -13 l -13 13');


	var txt = grp.children[6];
	txt.setAttribute('x', width / 2);
	txt.setAttribute('y', height / 2 + 4);

	var dX = width - oldWidth.baseVal.value;
	var r1 = grp.children[1];
	r1.setAttribute('y', height / 2.0);
	var r2 = grp.children[2];
	r2.setAttribute('x', width - 2.5);
	r2.setAttribute('y', height / 2.0);
	var r3 = grp.children[3];
	r3.setAttribute('x', width / 2.0);
	var r4 = grp.children[4];
	r4.setAttribute('x', width / 2.0);
	r4.setAttribute('y', height - 2.5);
    }



    function move(evt) {
	if (mode == DRAG) {
		var dX = evt.clientX - startX;
		var dY = evt.clientY - startY;
		var x = dX;
		var y = dY;
		currentBlock.setAttribute ('transform', 'translate(' + x + ',' + y +  ')');
	} else if (mode == RESIZE) {
		var newX = evt.clientX - startX;
		var newY = evt.clientY - startY;
		doResize(currentBlock, newX, newY);
	} else {
		alert();
	}	
    }


    function up(evt) {
        currentBlock=null;
	mode = DRAG;
    }

    function highlight(evt) {
        var target = evt.currentTarget;
	target.setAttribute('style','stroke: #999999; fill: #999999')
 
    }

    function out(evt) {
        var target = evt.currentTarget;
	target.setAttribute('style','stroke: #555588; fill: #555588')
    }

    var focusRect = null;

    function click(evt) {
	focusRect = evt.target;
    }

    function edit(evt) {
	var newVal = prompt("Update text", "");
	if (newVal == null || newVal == '') {
	    newVal = '?';
	}
	evt.target.textContent = newVal;

    }
	  ]]>
	</script> 

<path d="M 220 70 h 100 v 50 H 400" style="stroke: black; fill:none" />


<g transform="translate(20,20)"  onmousedown="down(evt)">    
<rect width="200" height="100" style="stroke: #555588; fill: #aaaaff" onclick="click(evt)"   />
<rect x="-2.5" y="47.5" width="5" height="5" style="stroke: #555588; fill: #555588" onmouseover="highlight(evt)" onmouseout="out(evt)" />
<rect x="197.5" y="47.5" width="5" height="5" style="stroke: #555588; fill: #555588" onmouseover="highlight(evt)" onmouseout="out(evt)" />
<rect x="97.5" y="-2.5" width="5" height="5" style="stroke: #555588; fill: #555588" onmouseover="highlight(evt)"  onmouseout="out(evt)" />
<rect x="97.5" y="97.5" width="5" height="5" style="stroke: #555588; fill: #555588" onmouseover="highlight(evt)"  onmouseout="out(evt)" />
<path d="M 200 100 v -13 l -13 13" style="stroke: #555588; fill: #555588" onmouseover="highlight(evt)"  onmouseout="out(evt)"  onmousedown="resize(evt)" />
<text id="text" x="102" y="54" text-anchor="middle"  onclick="edit(evt)">hello</text>
</g>


<g transform="translate(400,70)"   ondblclick="click(evt)" >
<rect width="200" height="100" style="stroke: #555588; fill: #aaaaff" />
<rect x="-2.5" y="47.5" width="5" height="5" style="stroke: #555588; fill: #555588" />
<rect x="197.5" y="47.5" width="5" height="5" style="stroke: #555588; fill: #555588" />
<rect x="97.5" y="-2.5" width="5" height="5" style="stroke: #555588; fill: #555588" />
<rect x="97.5" y="97.5" width="5" height="5" style="stroke: #555588; fill: #555588" />
</g>



</svg>
